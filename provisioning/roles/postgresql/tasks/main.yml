# file: postgresql/tasks/main.yml

- include_vars: "{{ item }}"
  with_first_found:
    - "../vars/{{ ansible_os_family }}.yml"
    - "../vars/empty.yml"
  tags: [always]

- include: install.yml
  when: ansible_pkg_mgr == "apt"
  tags: [postgresql, postgresql-install]

- include: install_yum.yml
  when: ansible_pkg_mgr == "yum"
  tags: [postgresql, postgresql-install]

- include: extensions.yml
  tags: [postgresql, postgresql-extensions]

- include: configure.yml
  tags: [postgresql, postgresql-configure]

- include: users.yml
  tags: [postgresql, postgresql-users]

- include: databases.yml
  tags: [postgresql, postgresql-databases]

- include: users_privileges.yml
  tags: [postgresql, postgresql-users]

- include: monit.yml
  when: monit_protection is defined and monit_protection == true
  tags: [postgresql, postgresql-monit]

- name: Set postgres user password
  postgresql_user:
    user: '{{ postgresql_admin_user }}'
    password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33333230653231303433373938333839616636646330303733656164383033316365373937626531
          6465343039656461353231373164633561336236636534330a393333393033336631316236666230
          66366364346634313262303538303039323465626361653766326463366566353366323565636432
          3630303232313832310a343537366464323731383239323764646330343235383562336636373133
          3137
